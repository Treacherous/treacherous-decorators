!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TreacherousDecorators=t():e.TreacherousDecorators=t()}(window,function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){function s(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}s(r(4)),s(r(2))},function(e,t,r){var s=r(3);t.PropertyResolver=s.PropertyResolver},function(e,t){var r=function(){return function(e,t){this.callback=e,this.predicate=t}}();t.EventListener=r},function(e,t){var r=function(){function e(){var e=this;this.indexRegex=/\[(\d)]/,this.splitRegex=/\./,this.resolveProperty=function(t,r){var s=null,i=[],o="";if("string"!=typeof r)throw new TypeError("propertyChain is not a string");return r.split(e.splitRegex).forEach(function(r){var n=-1;if(e.indexRegex.test(r)&&(n=e.indexRegex.exec(r)[1],r=r.replace(e.indexRegex,"")),s){if("object"!=typeof s)throw new TypeError('"'+s+'"  does not seem to be an object');if(n>=0){if(!(n<s[r].length))throw new TypeError('cannot find index "'+n+'" in '+o);i.push(s=s[r][n]),o=r[n]}else{if(!(r in s))throw new TypeError('cannot resolve "'+r+'" in '+o);i.push(s=s[r]),o=r}}else n>=0?0==r.length?(i.push(s=t[n]),o=n):(i.push(s=t[r][n]),o=r[n]):(o=r,i.push(s=t[r]))}),i[i.length-1]}}return e.prototype.decomposePropertyRoute=function(e){for(var t,r=[],s=e.split(this.splitRegex),i=0;i<s.length;i++)this.indexRegex.test(s[i])?(t=this.indexRegex.exec(s[i])[1],r.push(s[i].replace(this.indexRegex,"")),r.push("["+t+"]")):r.push(s[i]);return r},e.prototype.getPropertyRouteSection=function(e,t){return void 0===t&&(t=0),this.decomposePropertyRoute(e)[t]},e.prototype.buildPropertyRoute=function(e){for(var t="",r=0;r<e.length;r++)0!=t.length?e[r].indexOf("[")>=0?t+=""+e[r]:t+="."+e[r]:t+=e[r];return t},e}();t.PropertyResolver=r},function(e,t,r){var s=r(2),i=function(){return function(e){var t=this;this.sender=e,this.listeners=[],this.subscribe=function(e,r){return t.listeners.push(new s.EventListener(e,r)),function(){t.unsubscribe(e)}},this.unsubscribe=function(e){for(var r=0;r<t.listeners.length;r++)if(t.listeners[r].callback==e)return void t.listeners.splice(r,1)},this.unsubscribeAll=function(){t.listeners=[]},this.publish=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&setTimeout(function(){r.callback(e,t.sender)},1):setTimeout(function(){r.callback(e,t.sender)},1)})},this.publishSync=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&r.callback(e,t.sender):r.callback(e,t.sender)})},this.getSubscriptionCount=function(){return t.listeners.length}}}();t.EventHandler=i},function(e,t,r){"use strict";r.r(t);function s(e,t,r,s){return new(r||(r=Promise))(function(i,o){function n(e){try{l(s.next(e))}catch(e){o(e)}}function a(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(n,a)}l((s=s.apply(e,t||[])).next())})}class i extends Error{constructor(e){super(e),this.message=e}}var o=r(1);class n{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.isPropertyRoute=(e=>e.indexOf(".")>=0),this.isIndexRoute=(e=>e.indexOf("[")>=0),this.resolvePropertyRules=((e,t)=>{const r=this.propertyResolver.decomposePropertyRoute(e),s=r[r.length-1],i=this.traverseRulesForRoutes(r,t);return i?i.getRulesForProperty?i.getRulesForProperty(s):i:null}),this.getMatchingRuleForProperty=((e,t)=>{let r;for(let s=0;s<t.length;s++)if((r=t[s]).isForEach&&(r=r.internalRule),r.getRulesForProperty&&r.rules[e])return r}),this.traverseRulesForRoutes=((e,t)=>{const r=e.shift();let s=t;if(t.rules&&(s=s.rules[r]),!s)return null;if(0==e.length)return s;const i=e[0];if(!i)return t;if(this.isIndexRoute(i)){e.shift();const t=[];if(s.forEach(e=>{e.isForEach&&t.push(e.internalRule)}),e.length>0){const r=[];return t.forEach(t=>{const s=e.slice();this.traverseRulesForRoutes(s,t).forEach(e=>{r.push(e)})}),r}return t}if(0==e.length)return s;const o=this.getMatchingRuleForProperty(i,s);return e.length>0?this.traverseRulesForRoutes(e,o):o})}}class a{static isDateType(e){return"function"==typeof e.getMonth}static isFunctionType(e){return"function"==typeof e}static isSimpleType(e){return"string"==typeof e||"number"==typeof e}static isArrayType(e){return"[object Array]"===Object.prototype.toString.call(e)}static isEmptyValue(e){return void 0===e||null===e||0==e.length}static isObjectOrArray(e){return!!e&&(e.constructor===Array||e.constructor===Object)}static isRuleset(e){return"function"==typeof e.addRule}static isForEach(e){return e.isForEach}}class l{constructor(){this.promiseCallbacks=[],this.validationCounter=0,this.waitForCompletion=(()=>s(this,void 0,void 0,function*(){if(!this.validationCounter)return;return new Promise(e=>{this.promiseCallbacks.push(()=>e())})})),this.countPromise=(e=>s(this,void 0,void 0,function*(){if(!e)return;if(!e.then)throw new Error("Non-Promise pass in: "+e);this.incrementCounter();const t=yield e;return this.decrementCounter(),t})),this.decrementCounter=(()=>{if(this.validationCounter--,!this.validationCounter)for(;this.promiseCallbacks.length;)this.promiseCallbacks.shift()()}),this.incrementCounter=(()=>{this.validationCounter++})}}class u{constructor(e,t,r){this.property=e,this.isValid=t,this.error=r}}class h{constructor(e){this.isValid=e}}var c=r(0);class d{constructor(){this.propertySanitizerRegex=/\[(.*?)]/g,this.propertyNameOverrideCache={},this.recurseTree=((e,t)=>{for(const r in e.rules){const s=this.updateRouteName(t,r);e.rules[r].forEach(e=>{a.isForEach(e)&&a.isRuleset(e.internalRule)&&this.recurseTree(e.internalRule,s),a.isRuleset(e)&&this.recurseTree(e,s)})}if(0!=Object.keys(e.propertyDisplayNames).length)for(const r in e.propertyDisplayNames){const s=this.updateRouteName(t,r);this.propertyNameOverrideCache[s]=e.propertyDisplayNames[r]}}),this.updateRouteName=((e,t)=>e.length>0?`${e}.${t}`:t),this.cacheDisplayNamesFor=(e=>{this.recurseTree(e,"")}),this.getDisplayNameFor=(e=>{const t=e.replace(this.propertySanitizerRegex,"");return this.propertyNameOverrideCache[t]||e})}}class p{constructor(e,t=new n,r,i,o,p){this.fieldErrorProcessor=e,this.ruleResolver=t,this.modelResolverFactory=r,this.localeHandler=i,this.ruleset=p,this.propertyErrors={},this.validatePropertyWithRuleLinks=((e,t)=>s(this,void 0,void 0,function*(){const r=this.fieldErrorProcessor.checkFieldForErrors(this.modelResolver,e,t),s=yield this.promiseCounter.countPromise(r),i=this.hasErrors();if(!s){if(this.propertyErrors[e]){delete this.propertyErrors[e];const t=new u(e,!0);this.propertyStateChangedEvent.publish(t),i&&this.hasErrors()||this.modelStateChangedEvent.publish(new h(!0))}return this.promiseCounter.waitForCompletion()}const o=this.propertyErrors[e];if(this.propertyErrors[e]=s,s!=o){const t=new u(e,!1,s);this.propertyStateChangedEvent.publish(t),i||this.modelStateChangedEvent.publish(new h(!1))}return this.promiseCounter.waitForCompletion()})),this.validatePropertyWithRuleSet=((e,t)=>{let r;for(const s in t.rules)r=`${e}.${s}`,this.validatePropertyWithRules(r,t.getRulesForProperty(s))}),this.validatePropertyWithRules=((e,t)=>{const r=[],s=[];let i;try{i=this.modelResolver.resolve(e)}catch(t){throw console.warn(`Failed to resolve property ${e} during validation. Does it exist in your model?`),t}t.forEach(t=>{a.isForEach(t)?a.isArrayType(i)?i.forEach((r,s)=>{const i=`${e}[${s}]`;this.validatePropertyWithRules(i,[t.internalRule])}):a.isRuleset(t.internalRule)?s.push(t.internalRule):r.push(t.internalRule):a.isRuleset(t)?s.push(t):r.push(t)}),this.validatePropertyWithRuleLinks(e,r),s.forEach(t=>{this.validatePropertyWithRuleSet(e,t)})}),this.startValidateProperty=(e=>s(this,void 0,void 0,function*(){if(Object.keys(this.ruleset.compositeRules).length>0&&(yield this.validateCompositeRules()),void 0!==this.ruleset.compositeRules[e])return;const t=this.ruleResolver.resolvePropertyRules(e,this.ruleset);return t?this.validatePropertyWithRules(e,t):void 0})),this.validateCompositeRule=(e=>s(this,void 0,void 0,function*(){const t=this.hasErrors();if(yield e.validate(this.modelResolver)){if(this.propertyErrors[e.virtualPropertyName]){delete this.propertyErrors[e.virtualPropertyName];const t=new u(e.virtualPropertyName,!0);this.propertyStateChangedEvent.publish(t)}return void(t&&this.hasErrors()||this.modelStateChangedEvent.publish(new h(!0)))}const r=this.propertyErrors[e.virtualPropertyName],s=yield this.localeHandler.getMessage(e.virtualPropertyName,e,this.modelResolver,null);if(this.propertyErrors[e.virtualPropertyName]=s,s!=r){const r=new u(e.virtualPropertyName,!1,s);this.propertyStateChangedEvent.publish(r),t||this.modelStateChangedEvent.publish(new h(!1))}return this.propertyErrors[e.virtualPropertyName]})),this.validateCompositeRules=(()=>s(this,void 0,void 0,function*(){for(const e in this.ruleset.compositeRules){const t=this.ruleset.compositeRules[e];yield this.validateCompositeRule(t)}})),this.startValidateModel=(()=>s(this,void 0,void 0,function*(){Object.keys(this.ruleset.compositeRules).length>0&&(yield this.validateCompositeRules());for(const e in this.ruleset.rules)yield this.startValidateProperty(e)})),this.changeValidationTarget=(e=>{this.modelResolver=this.modelResolverFactory.createModelResolver(e)}),this.validateProperty=(e=>s(this,void 0,void 0,function*(){return yield this.startValidateProperty(e),yield this.promiseCounter.waitForCompletion(),!this.propertyErrors[e]})),this.validate=(()=>s(this,void 0,void 0,function*(){return yield this.startValidateModel(),yield this.promiseCounter.waitForCompletion(),!this.hasErrors()})),this.getModelErrors=((e=!1)=>s(this,void 0,void 0,function*(){return e&&(yield this.startValidateModel()),yield this.promiseCounter.waitForCompletion(),this.propertyErrors})),this.getPropertyError=((e,t=!1)=>s(this,void 0,void 0,function*(){return t&&(yield this.startValidateProperty(e)),yield this.promiseCounter.waitForCompletion(),this.propertyErrors[e]})),this.getPropertyDisplayName=(e=>this.displayNameCache.getDisplayNameFor(e)),this.isPropertyInGroup=(e=>{return null!=this.ruleResolver.resolvePropertyRules(e,this.ruleset)}),this.release=(()=>{}),this.propertyStateChangedEvent=new c.EventHandler(this),this.modelStateChangedEvent=new c.EventHandler(this),this.displayNameCache=new d,this.promiseCounter=new l,this.modelResolver=this.modelResolverFactory.createModelResolver(o),this.displayNameCache.cacheDisplayNamesFor(p)}hasErrors(){return Object.keys(this.propertyErrors).length>0}}class f extends p{constructor(e,t=new n,r,s,i,o,a,l=500){super(e,t,r,i,o,a),this.modelWatcherFactory=s,this.localeHandler=i,this.refreshRate=l,this.onModelChanged=(e=>{this.startValidateProperty(e.propertyPath)}),this.release=(()=>{this.modelWatcher&&this.modelWatcher.stopWatching()}),this.modelWatcher=this.modelWatcherFactory.createModelWatcher(),this.modelWatcher.setupWatcher(o,a,l),this.modelWatcher.onPropertyChanged.subscribe(this.onModelChanged)}}class v{constructor(e,t){this.propertyPath=e,this.previousValue=t}}class y{constructor(e,t,r){this.propertyPath=e,this.newValue=t,this.oldValue=r}}class m{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.watchCache=[],this.watchCacheKeys=[],this.watcherInterval=null,this.setupWatcher=((e,t,r=500)=>{this.model=e,this.ruleset=t,this.scanInterval=r,this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.scanProperties(),this.startWatching()}),this.changeWatcherTarget=(e=>{this.model=e,this.scanProperties()}),this.startWatching=(()=>{this.stopWatching(),this.watcherInterval=setInterval(this.scanProperties,this.scanInterval)}),this.stopWatching=(()=>{this.watcherInterval&&clearInterval(this.watcherInterval)}),this.updateAndNotifyDifferences=(()=>{const e=this.watchCacheKeys,t=this.watchCache;this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.watchCacheKeys.forEach((r,s)=>{let i;if(-1==e.indexOf(r)){i=this.watchCache[s].previousValue;const e=new y(r,i,null);setTimeout(()=>{this.onPropertyChanged.publish(e)},1)}else if(t[s].previousValue&&t[s].previousValue.isArray&&t[s].previousValue.length!=this.watchCache[s].previousValue.length){const e=this.watchCache[s].previousValue;i=t[s].previousValue;const o=new y(r,e,i);setTimeout(()=>{this.onPropertyChanged.publish(o)},1)}})}),this.watchProperty=((e,t)=>{if(-1==this.watchCacheKeys.indexOf(e)){const r=new v(e,t);this.watchCache.push(r),this.watchCacheKeys.push(e)}}),this.cacheWatchTargets=((e,t)=>{let r,s,i,o,n,l;for(const u in t.rules){r=e?e+"."+u:u,s=t.rules[u],i=!1,o=!1,s.forEach(function(e){e.isForEach&&(i=!0),e.getRulesForProperty&&(o=!0)}),n=!1;try{l=this.propertyResolver.resolveProperty(this.model,r),n=!0}catch(e){}null==l&&(i||o)&&(l=i?[]:o?{}:null),s.forEach(e=>{const t=a.isArrayType(l);if(t){const e={length:l.length,isArray:!0};this.watchProperty(r,e)}e.isForEach&&n?e.internalRule.getRulesForProperty?this.model[u]&&this.model[u].forEach((t,s)=>{this.cacheWatchTargets(r+"["+s+"]",e.internalRule)}):this.model[u]&&this.model[u].forEach((e,t)=>{this.watchProperty(r+"["+t+"]",this.model[u][t])}):e.getRulesForProperty?this.cacheWatchTargets(r,e):t||this.watchProperty(r,l)})}}),this.scanProperties=(()=>{if(0==this.onPropertyChanged.getSubscriptionCount())return;if(0==this.watchCache.length)return;let e=!1;this.watchCache.forEach(t=>{let r,s=!1;try{r=this.propertyResolver.resolveProperty(this.model,t.propertyPath)}catch(e){}if(void 0===r&&(r=t.previousValue),t.previousValue&&t.previousValue.isArray){(r.length||0)!=t.previousValue.length&&(s=!0)}else if(r!==t.previousValue){const e=new y(t.propertyPath,r,t.previousValue);setTimeout(()=>{this.onPropertyChanged.publish(e)},1),t.previousValue=r}s&&(e=!0)}),e&&setTimeout(this.updateAndNotifyDifferences,1)}),this.onPropertyChanged=new c.EventHandler(this)}}class R{constructor(){this.createModelWatcher=(()=>new m)}}class F{constructor(e,t){this.propertyResolver=e,this.model=t}resolve(e){return this.propertyResolver.resolveProperty(this.model,e)}}class g{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.createModelResolver=(e=>new F(this.propertyResolver,e))}}class w{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.refreshRate=500,this.validateOnStart=!1,this.modelWatcherFactory=new R,this.modelResolverFactory=new g,this)),this.withRefreshRate=(e=>(this.refreshRate=e,this)),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.withModelWatcherFactory=(e=>(this.modelWatcherFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new f(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.modelWatcherFactory,this.localeHandler,e,t,this.refreshRate);return this.validateOnStart&&r.validate(),r})}}class E{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.modelResolverFactory=new g,this.validateOnStart=!1,this)),this.asReactiveGroup=(()=>{return new w(this.fieldErrorProcessor,this.ruleResolver,this.localeHandler).create().withModelResolverFactory(this.modelResolverFactory)}),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new p(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.localeHandler,e,t);return this.validateOnStart&&r.validate(),r})}}class C{static simpleTypeComparer(e,t,r){return r?e==t:e===t}static dateTimeCompararer(e,t){return e.getTime()==t.getTime()}}let P;P||((P=new class{constructor(){this.rules={},this.registerRule=(e=>{this.rules[e.ruleName]=e}),this.unregisterRule=(e=>{delete this.rules[e.ruleName]}),this.getRuleNamed=(e=>this.rules[e]||null),this.hasRuleNamed=(e=>null!=this.getRuleNamed(e))}}).registerRule(new class{constructor(){this.ruleName="date",this.invalidObjectRegex=/Invalid|NaN/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!a.isEmptyValue(r)||!this.invalidObjectRegex.test(new Date(r))})}}),P.registerRule(new class{constructor(){this.ruleName="decimal",this.decimalRegex=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!a.isEmptyValue(r)||this.decimalRegex.test(r)})}}),P.registerRule(new class{constructor(){this.ruleName="email",this.emailRegex=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!a.isEmptyValue(r)||this.emailRegex.test(r)})}}),P.registerRule(new class{constructor(){this.ruleName="equal"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(a.isEmptyValue(s))return!0;let i=r.value||r;const o=r.weakEquality||!1;return a.isFunctionType(i)&&(i=i()),a.isDateType(i)?C.dateTimeCompararer(s,i):C.simpleTypeComparer(s,i,o)})}}),P.registerRule(new class{constructor(){this.ruleName="isoDate",this.isoDateRegex=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!a.isEmptyValue(r)||this.isoDateRegex.test(r)})}}),P.registerRule(new class{constructor(){this.ruleName="maxLength"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!a.isEmptyValue(s)||s.length<=r})}}),P.registerRule(new class{constructor(){this.ruleName="maxValue"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!a.isEmptyValue(s)||s<=r})}}),P.registerRule(new class{constructor(){this.ruleName="minLength"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!a.isEmptyValue(s)||s.length>=r})}}),P.registerRule(new class{constructor(){this.ruleName="minValue"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!a.isEmptyValue(s)||s>=r})}}),P.registerRule(new class{constructor(){this.ruleName="notEqual"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(a.isEmptyValue(s))return!0;let i=r.value||r;const o=r.weakEquality||!1;return a.isFunctionType(i)&&(i=i()),a.isDateType(i)?!C.dateTimeCompararer(s,i):!C.simpleTypeComparer(s,i,o)})}}),P.registerRule(new class{constructor(){this.ruleName="number",this.numberRegex=/^\d+$/}validate(e,t){return s(this,void 0,void 0,function*(){const r=e.resolve(t);return!!a.isEmptyValue(r)||this.numberRegex.test(r)})}}),P.registerRule(new class{constructor(){this.ruleName="regex"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);return!!a.isEmptyValue(s)||null!==s.toString().match(r)})}}),P.registerRule(new class{constructor(){this.ruleName="required"}validate(e,t,r=!0){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(void 0===s||null===s)return!r;let i=s;return"string"==typeof i&&(i=String.prototype.trim?s.trim():s.replace(/^\s+|\s+$/g,"")),!r||(i+"").length>0})}}),P.registerRule(new class{constructor(){this.ruleName="step"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=e.resolve(t);if(a.isEmptyValue(s))return!0;const i=100*s%(100*r);return Math.abs(i)<1e-5||Math.abs(1-i)<1e-5})}}),P.registerRule(new class{constructor(){this.ruleName="matches"}validate(e,t,r){return s(this,void 0,void 0,function*(){const s=r.property||r,i=r.weakEquality||!1,o=e.resolve(t),n=e.resolve(s);return void 0===o||null===o?void 0===n||null===n:a.isDateType(o)?C.dateTimeCompararer(o,n):C.simpleTypeComparer(o,n,i)})}}));class x{constructor(){this.rules={},this.compositeRules={},this.propertyDisplayNames={},this.createPropertyEntryIfNeeded=(e=>{this.rules[e]||(this.rules[e]=[])}),this.addRule=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addRuleset=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addCompositeRule=(e=>{this.compositeRules[e.virtualPropertyName]=e}),this.addPropertyDisplayName=((e,t)=>this.propertyDisplayNames[e]=t),this.getRulesForProperty=(e=>this.rules[e]),this.getCompositeRulesRulesForProperty=(e=>this.compositeRules[e])}}class b{constructor(e,t){this.ruleName=e,this.ruleOptions=t,this.appliesIf=!0}}class D{constructor(e){this.internalRule=e,this.isForEach=!0}}const N=new class{constructor(){this.localeResources={},this.getCurrentLocale=(()=>this.localeCode),this.registerLocale=((e,t)=>s(this,void 0,void 0,function*(){this.localeCode=e,this.localeResources[this.localeCode]=t})),this.useLocale=(e=>s(this,void 0,void 0,function*(){if(!this.localeResources[e])throw`Unable to find registered locale for [${e}]`;this.localeCode=e})),this.supplementLocaleFrom=((e,t)=>s(this,void 0,void 0,function*(){this.localeResources[e]||(this.localeResources[e]={});for(const r in t)this.localeResources[e][r]=t[r]})),this.getMessage=((e,t,r,i)=>s(this,void 0,void 0,function*(){const s=this.localeResources[this.localeCode],o=s[e]||s.default||`Cannot find rule for ${e}`;return"string"==typeof o?o:3===o.length||null==i?o(r,i,t):o(r.resolve(i),t)}))}};N.registerLocale("en-us",{default:"This field is invalid",required:"This field is required",date:e=>`This field contains "${e}" which is not a valid date`,decimal:e=>`This field contains ${e} which is not a decimal value`,equal:(e,t)=>`This field is ${e} but should be equal to ${t.value||t}`,notEqual:(e,t)=>`This field is ${e} but should not be equal to ${t.value||t}`,isoDate:e=>`This field contains "${e}" which is not a valid ISO date`,maxLength:(e,t)=>`This field has a length of ${e.length} but should contain no more than ${t}`,minLength:(e,t)=>`This field has a length of ${e.length} but should more than ${t}`,maxValue:(e,t)=>`This field has a value of ${e} but should be less than or equal to ${t}`,minValue:(e,t)=>`This field has a value of ${e} but should be greater than or equal to ${t}`,number:e=>`This field contains ${e} which is not a numeric value`,regex:"This field does not match the expected format",step:(e,t)=>`This field has a value of ${e} and should be an increment of ${t}`,matches:(e,t,r)=>{const s=e.resolve(t),i=r.property||r;return`This field is ${s} but should match ${e.resolve(i)}`}}),N.useLocale("en-us");const T=new class{constructor(e,t){this.ruleRegistry=e,this.localeHandler=t,this.processRuleLink=((e,t,r)=>s(this,void 0,void 0,function*(){if(!(!0===r.appliesIf||"function"==typeof r.appliesIf&&r.appliesIf(e,t,r.ruleOptions)))return;const s=this.ruleRegistry.getRuleNamed(r.ruleName);if(!s)throw new i(`No validator can be found for rule [${r.ruleName}]`);const o="function"==typeof r.ruleOptions?r.ruleOptions():r.ruleOptions;if(yield s.validate(e,t,o))return;let n;throw n=r.messageOverride?"function"==typeof r.messageOverride?r.messageOverride(e,t,r.ruleOptions):r.messageOverride:yield this.localeHandler.getMessage(r.ruleName,r.ruleOptions,e,t),new i(n)})),this.checkFieldForErrors=((e,t,r)=>s(this,void 0,void 0,function*(){const s=r=>this.processRuleLink(e,t,r);return Promise.resolve(r).then(e=>{const t=[];return e.forEach(e=>{t.push(s(e))}),Promise.all(t)}).then(function(){return null}).catch(e=>e.message)}))}}(P,N),V=new n;const O=Symbol("ruleset");function S(e){const t=e.prototype||e;return Reflect.hasMetadata(O,t)?Reflect.getMetadata(O,t):new x}function $(e,t){const r=e.prototype||e;Reflect.defineMetadata(O,t,r)}function W(e){return S(e)}function M(e,t){const r=W(e.constructor);let s=new E(T,V,N).create();return t||t(s),s.build(e,r)}function A(e){return function(t,r){const s=S(t);s.propertyDisplayNames[r]=e,$(t,s)}}function k(e,t,r,s){return function(i,o){const n=S(i),a=new b(e,t);void 0!==typeof r&&(a.appliesIf=r),void 0!==typeof s&&(a.messageOverride=s),n.addRule(o,new D(a)),$(i,n)}}function j(e,t,r,s){return function(i,o){const n=S(i),a=new b(e,t);void 0!==r&&(a.appliesIf=r),void 0!==s&&(a.messageOverride=s),n.addRule(o,a),$(i,n)}}function I(e){return function(t,r){const s=S(t);if("function"==typeof e){const t=S(e);s.addRuleset(r,new D(t))}else s.addRuleset(r,new D(e));$(t,s)}}function q(e){return function(t,r){const s=S(t);if("function"==typeof e){const t=S(e);s.addRuleset(r,t)}else s.addRuleset(r,e);$(t,s)}}function L(e,t){return j("date",!0,e,t)}function H(e,t){return j("decimal",!0,e,t)}function z(e,t){return j("email",!0,e,t)}function _(e,t,r){return j("equal",e,t,r)}function K(e,t){return j("isoDate",!0,e,t)}function G(e,t,r){return j("matches",e,t,r)}function Z(e,t,r){return j("maxLength",e,t,r)}function U(e,t,r){return j("maxValue",e,t,r)}function B(e,t,r){return j("minLength",e,t,r)}function J(e,t,r){return j("minValue",e,t,r)}function Q(e,t,r){return j("notEqual",e,t,r)}function X(e,t){return j("number",!0,e,t)}function Y(e,t,r){return j("regex",e,t,r)}function ee(e,t){return j("required",!0,e,t)}function te(e,t,r){return j("step",e,t,r)}r.d(t,"createRulesetFor",function(){return W}),r.d(t,"createGroupFor",function(){return M}),r.d(t,"rulesetMetadataKey",function(){return O}),r.d(t,"getRulesetFromMetadata",function(){return S}),r.d(t,"updateRulesetMetadata",function(){return $}),r.d(t,"withDisplayName",function(){return A}),r.d(t,"withRuleForEach",function(){return k}),r.d(t,"withRule",function(){return j}),r.d(t,"withRulesetForEach",function(){return I}),r.d(t,"withRuleset",function(){return q}),r.d(t,"date",function(){return L}),r.d(t,"decimal",function(){return H}),r.d(t,"email",function(){return z}),r.d(t,"equal",function(){return _}),r.d(t,"isoDate",function(){return K}),r.d(t,"matches",function(){return G}),r.d(t,"maxLength",function(){return Z}),r.d(t,"maxValue",function(){return U}),r.d(t,"minLength",function(){return B}),r.d(t,"minValue",function(){return J}),r.d(t,"notEqual",function(){return Q}),r.d(t,"number",function(){return X}),r.d(t,"regex",function(){return Y}),r.d(t,"required",function(){return ee}),r.d(t,"step",function(){return te})}])});